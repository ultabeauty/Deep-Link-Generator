<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Native App Deep Link Generator</title>
        <meta name="description" content="App Intercept / Deep Link Tester">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

        <style>

            html { background: #f2f2f2; }
            * { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif; color: #303030; font-size: 15px;  }

            h1 { font-size: 22px; color: #303030; }
            h2 { font-size: 17px; color: #303030; font-weight: 600; display: inline-block }
            h3 { font-size: 15px; color: #303030; font-weight: 400; display: inline-block; font-size: 16px; }
            h4 { font-size: 13px; display: inline-block }
            h5 { font-size: 12px; display: inline-block; color: gray; }

            input { width: 75%; height: 28px; margin-bottom:  8px; }

            select { width: 50%; margin-bottom: 8px; }

            label { display: block; margin-bottom:  8px; }

            #content { padding: 16px; }

            #helptext { display:  none; }

            #generate_button { padding:5px 15px; background:#ff0064; color: #fff; font-weight: bold; border:0 none; cursor:pointer; -webkit-border-radius: 5px; border-radius: 5px; height: 44px; width:  100%; font-size: 17px; text-transform: uppercase; margin-top:  16px; }
            #generate_button:hover { background:#ff99ad; }

            #test_button { padding:5px 15px; background:#fff; color: #ff0064; font-weight: bold; border:0 none; cursor:pointer; -webkit-border-radius: 5px; border-radius: 5px; border: 2px solid #ff0064; height: 44px; width:  100%; font-size: 17px; text-transform: uppercase; margin-top:  16px; }
            #test_button:hover { background:#ff99ad; }

            #changelog { margin-top:  100px; }
            #changelog textarea { display:  block; width:  100%; height: auto; }

            #changelog ul { margin-bottom:  24px; padding-left: 16px }
            #changelog ul li { font-size: 12px; padding-bottom: 4px; padding-top: 4px; border-bottom: 1px solid silver; }

        </style>
        <script>

            var deeplinks = [
                { display : '----------------------------------------------- Tabs -----------------------------------------------', type : 3 },
                { display : 'Home', name : 'tab=home', fields : [ ], type : 0 },
                { display : 'Favorites', name : 'tab=favorites', fields : [ ], type : 0 },
                { display : 'Stores', name : 'tab=stores', fields : [ ], type : 0 },
                { display : 'Bag', name : 'tab=bag', fields : [ ], type : 0 },
                { display : 'More', name : 'tab=more', fields : [ ], type : 0 },
                { display : '----------------------------------------------- Pages -----------------------------------------------', type : 3 },
                { display : 'BMSM', name : 'page=shop/on_sale/buy_more_save_more', fields : [ ], type : 1 },
                { display : 'Coupons', name : 'page=coupons', fields : [ ], type : 1 },
                { display : 'Credit Cards', name : 'page=credit_cards', fields : [ ], type : 1 },
                { display : 'Current Ad', name : 'page=current_ad', fields : [ ], type : 1 },
                { display : 'Gift Cards', name : 'page=gift_cards', fields : [ ], type : 1 },
                { display : 'Gift Card - Buy', name : 'page=gift_cards/buy', fields : [ ], type : 1 },
                { display : 'Gift Card - Plastic', name : 'page=gift_cards/plastic', fields : [ ], type : 1 },
                { display : 'GWP', name : 'page=shop/on_sale/gift_with_purchase', fields : [ ], type : 1 },
                { display : 'In the Mix', name : 'page=ulta_beauty_mix', fields : [ ], type : 1 },
                { display : 'My Account', name : 'page=my_account', fields : [ ], type : 1 },
                { display : 'New Arrivals', name : 'page=new_arrivals', fields : [ ], type : 1 },
                { display : 'New Arrivals - Boost', name : 'page=new_arrivals', fields : [ { value : 'sort', required : false } ], type : 1 },
                { display : 'On Sale', name : 'page=shop/on_sale', fields : [ ], type : 1 },
                { display : 'On Sale > Sale', name : 'page=shop/on_sale/sale', fields : [ ], type : 1 },
                { display : 'Rewards', name : 'page=rewards', fields : [ ], type : 1 },
                { display : 'Rewards - Bonus Offers', name : 'page=rewards/bonus_offers', fields : [ ], type : 1 },
                { display : 'Sale & Coupons', name : 'page=sale_and_coupons', fields : [ ], type : 1 },
                { display : 'Salon - Book Appointment', name : 'page=book_appointment', fields : [ ], type : 1 },
                { display : 'Settings', name : 'page=settings', fields : [ ], type : 1 },
                { display : 'Shop', name : 'page=shop', fields : [ ], type : 1 },
                { display : 'Shop by Brands', name : 'page=shop_by_brands', fields : [ ], type : 1 },
                { display : 'Social Gallery', name : 'page=social_gallery', fields : [ ], type : 1 },
                { display : 'Virtual Beauty', name : 'page=virtual_beauty', fields : [ ], type : 1 },
                { display : '----------------------------------------------- Dynamic -----------------------------------------------', type : 3 },
                { display : 'Web', name : 'page=web', fields : [ { value : 'url', required : true, hint : 'Must be https. Should include ?source=native' }, { value : 'title', required : false }], type : 2 },
                { display : 'PDP', name : 'page=pdp', fields : [ { value : 'productid', required : true, hint : 'pimprod2003852' }, { value : 'skuid', required : false }], type : 2 },
                { display : 'PLP - Brand Listing Page', name : 'page=plp', fields : [ { value : 'type', initial : 'brand', required : true }, { value : 'value', required : true, hint : '9719' }, { value : 'title', required : false }, { value : 'sort', required : false, hint : 'use " " for relevance, other options: bestSellers, topRated, isNew, minSkuUltaPrice, maxSkuUltaPrice'}], type : 2 },
                { display : 'PLP - N Value', name : 'page=plp', fields : [ { value : 'type', initial : 'n', required : true }, { value : 'value', required : true, hint : '1z12lx1Z26y1' }, { value : 'title', required : false }, { value : 'sort', required : false, hint : 'use " " for relevance, other options: bestSellers, topRated, isNew, minSkuUltaPrice, maxSkuUltaPrice' }], type : 2 },
                { display : 'PLP - Promotion', name : 'page=plp', fields : [ { value : 'type', initial : 'promotion', required : true }, { value : 'value', required : true, hint : '0000143832' }, { value : 'title', required : false }, { value : 'sort', required : false, hint : 'use " " for relevance, other options: bestSellers, topRated, isNew, minSkuUltaPrice, maxSkuUltaPrice' }], type : 2 },
                { display : 'PLP - Keyword / Featured', name : 'page=plp', fields : [ { value : 'type', initial : 'keyword', required : true }, { value : 'value', required : true, hint : 'benefithoolawk36 or Pink Lipstick' }, { value : 'title', required : false }, { value : 'sort', required : false, hint : 'use " " for relevance, other options: bestSellers, topRated, isNew, minSkuUltaPrice, maxSkuUltaPrice' } ], type : 2 }

            ];








            function populateDeepLinks()
            {

                for(var i = 0; i < deeplinks.length; i++)
                {
                    var field_display_name = deeplinks[i].display;
                    var field_name = deeplinks[i].name;
                    var field_type = deeplinks[i].type;

                    var opt = document.createElement('option');
                    opt.value = field_name;
                    opt.innerHTML = field_display_name;
                    opt.disabled = (field_type == 3) ? true : false;
                    document.getElementById('page').appendChild(opt);
                }


                //Check for App Param
                document.getElementById('test_button').disabled = true;
            }







            function pageSelected()
            {
                document.getElementById('parameters').innerHTML = '';

                var index = event.target.selectedIndex - 1;

                var deeplink = deeplinks[index];
                var deeplink_fields = deeplink.fields;

                var html = '';

                for(var i = 0; i < deeplink_fields.length; i++)
                {
                    var deeplink_field = deeplink_fields[i];

                    //Header
                    var x = document.createElement("LABEL");
                    x.innerHTML = deeplink_field.value + ((deeplink_field.hint) ? ' (' + deeplink_field.hint + ')' : " ");
                    document.getElementById('parameters').appendChild(x);

                    //Field
                    var opt = document.createElement('INPUT');
                    opt.setAttribute("type", "text");
                    opt.name = deeplink_field.value;
                    opt.value = (deeplink_field.initial) ? deeplink_field.initial : '';
                    opt.disabled = (deeplink_field.initial) ? true : false;
                    opt.required = deeplink_field.required;
                    opt.placeholder = (deeplink_field.required) ? 'Required' : 'Optional';

                    /*
                    if(deeplink_field.value == "url")
                    {
                        opt.onblur = validateURL;
                    }
                    */

                    document.getElementById('parameters').appendChild(opt);
                }


                     //Manually Add the TID Field
                    var x = document.createElement("LABEL");
                    x.innerHTML = "tid (Tracking ID)"
                    document.getElementById('parameters').appendChild(x);

                    //Field
                    var opt = document.createElement('INPUT');
                    opt.setAttribute("type", "text");
                    opt.name = "tid"
                    opt.value = '';
                    opt.disabled = false;
                    opt.required = false;
                    opt.placeholder = "Optional";

                    document.getElementById('parameters').appendChild(opt);
                    //End



                document.getElementById('helptext').style.display = 'block';
                document.getElementById('generate_button').disabled = false;
                document.getElementById('test_button').disabled = false;
            }







            function generateDeepLink()
            {
                var base = 'ulta://go?';

                var parameters = document.getElementById('parameters');
                var page = document.getElementById('page');
                var inputs = parameters.getElementsByTagName('INPUT');

                var append = '';

                for(var i = 0; i < inputs.length; i++)
                {
                    var inputNode = inputs[i];

                    //Check for Required fields with no data
                    if(inputNode.required && inputNode.value.length == 0)
                    {
                        alert(inputNode.name + ' is required.');
                        return nil;
                    }


                    if(inputNode.name == 'url')
                    {
                        if(inputNode.value.length > 0)
                        {
                            if(append.length > 0) { append += '&'; }
                            append += inputNode.name + '=' + encodeURIComponent(inputNode.value);
                        }
                    }
                    else if(inputNode.name == 'value')
                    {
                        if(inputNode.value.length > 0)
                        {
                            if(append.length > 0) { append += '&'; }
                            append += inputNode.name + '=' + encodeURIComponent(inputNode.value);
                        }
                    }
                    else if(inputNode.name == 'title')
                    {
                        if(inputNode.value.length > 0)
                        {
                            if(append.length > 0) { append += '&'; }
                            append += inputNode.name + '=' + encodeURIComponent(inputNode.value);
                        }

                    }
                    else
                    {
                        if(inputNode.value.length > 0)
                        {
                            if(append.length > 0) { append += '&'; }
                            append += inputNode.name + '=' + inputNode.value;
                        }
                    }
                }

                if(append.length > 0)
                {
                    return(base + page.value + '&' + append);
                }
                else
                {
                    return(base + page.value);
                }

            }




            function showDeepLink()
            {
                var deep_link = generateDeepLink();

                if(deep_link)
                    {
                prompt('',deep_link);
                    }
            }




            function testDeepLink()
            {
                var deep_link = generateDeepLink();
                window.location.href = deep_link;
            }





            function validateURL()
            {
                var parameters = document.getElementById('parameters');
                var inputs = parameters.getElementsByTagName('INPUT');
                var warning = '';

                for(var i = 0; i < inputs.length; i++)
                {
                    var inputNode = inputs[i];

                    if(inputNode.name == 'url')
                    {

                        var pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol
  '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|'+ // domain name
  '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
  '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
  '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
  '(\\#[-a-z\\d_]*)?$','i'); // fragment locator

                        if(!pattern.test(inputNode.value))
                        {
                            alert("not a url");
                        }
                    }
                }
            }


        </script>

    </head>
    <body onload='populateDeepLinks()'>

        <div id="content">
            <h1>Native App - Deeplink Generator</h1>
            <select name="deeplinks" onchange="pageSelected()" id="page">
                <option value="" disabled selected>Select your option</option>
            </select>
            <hr>

            <h1>Parameters</h1>
            <div id="parameters"><h3>Select a page above to get started.</h3></div>
            <h5 id="helptext">• I will URLEncode the url for you<br>• I will encode the title for you<br>• I will encode keywords and category names for you</h5>
            <hr>

            <input type="submit" onclick="showDeepLink()" value="Show Deep Link" id="generate_button" disabled>
            <input type="submit" onclick="testDeepLink()" value="Test Deep Link (on Phone only) *" id="test_button">
            <p>* If you're using Chrome the test button may not work due to Chrome not allowing JS redirects, please use show deep link button, copy the deeplink, and then paste in your URL bar.</p>
            <div id="changelog">
                <h2>Changelog:</h2>
            <textarea rows="20" readonly>
Updated: 02/15/19
• Fixes for email marketing team clarity

Updated: 04/16/18
• Added URL encoding of value input (mostly needed for keyword search with multiple words)

Updated: 03/15/18
• Added 'tid' param to dynamic deeplinks for omniture tracking

Updated: 11/20/17
• Removed the https check as we are using http for holiday to avoid cache issues

Updated: 11/14/17
• Added support for left navigation root category linking, 5.2+ only
• Fixed title encoding for all words, before only worked if two word title
• Made 'Test Deep Link' button visible for everyone
• titles now use true urlecoding %20 over +
                </textarea>
            </div>
        </div>


    </body>
</html>
